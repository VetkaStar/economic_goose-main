# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Realtime –≤ –∞—É–∫—Ü–∏–æ–Ω–µ

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏:

1. ‚ùå **–°—Ç–∞–≤–∫–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –Ω—É–∂–Ω–æ –±—ã–ª–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. ‚ùå **–¢–∞–π–º–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∞—É–∫—Ü–∏–æ–Ω–∞ —á–µ—Ä–µ–∑ Realtime
3. ‚ùå **–¢–∞–π–º–µ—Ä –∑–∞–≤–∏—Å–∞–ª –Ω–∞ 0** –∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∞–ª –∞—É–∫—Ü–∏–æ–Ω
4. ‚ùå **–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å**
5. ‚ùå **–°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è**

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. –¢–∞–π–º–µ—Ä –∞—É–∫—Ü–∏–æ–Ω–∞ ‚úÖ
**–ë—ã–ª–æ:**
```typescript
if (currentAuction.value.time_left > 0) {
  currentAuction.value.time_left--
  
  if (currentAuction.value.time_left === 0) {  // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è!
    finishAuction()
  }
}
```

**–°—Ç–∞–ª–æ:**
```typescript
if (currentAuction.value) {
  // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º
  if (currentAuction.value.time_left <= 0) {
    stopTimer()
    finishAuction()
    return
  }
  
  currentAuction.value.time_left--  // –ü–æ—Ç–æ–º —É–º–µ–Ω—å—à–∞–µ–º
}
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ Realtime ‚úÖ
**–ë—ã–ª–æ:**
```typescript
currentAuction.value.status = payload.new.status  // –û–±–Ω–æ–≤–∏–ª–∏ —Å—Ç–∞—Ç—É—Å

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å (–Ω–æ –æ–Ω —É–∂–µ –Ω–æ–≤—ã–π!)
if (payload.new.status === 'active' && currentAuction.value.status !== 'active') {
  startTimer()  // –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è!
}
```

**–°—Ç–∞–ª–æ:**
```typescript
const oldStatus = currentAuction.value.status  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ä—ã–π

currentAuction.value.status = payload.new.status  // –û–±–Ω–æ–≤–ª—è–µ–º

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Ö–æ–¥ waiting -> active
if (payload.new.status === 'active' && oldStatus !== 'active') {
  startTimer()  // –†–∞–±–æ—Ç–∞–µ—Ç!
}
```

### 3. –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è ‚úÖ

–¢–µ–ø–µ—Ä—å –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞:
- ‚úÖ `auctions` UPDATE - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏, —Å—Ç–∞—Ç—É—Å–∞, –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ `auction_bids` INSERT - –Ω–æ–≤—ã–µ —Å—Ç–∞–≤–∫–∏
- ‚úÖ `auction_participants` INSERT - –Ω–æ–≤—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏

### 4. –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI ‚úÖ

–ü—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ —Å—Ç–∞–≤–∫–∏:
1. –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π UI (–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è)
2. –ß–µ—Ä–µ–∑ ~100-500–º—Å Realtime –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. –î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏ –≤–∏–¥—è—Ç —á–µ—Ä–µ–∑ Realtime

### 5. RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ Realtime ‚úÖ

–î–æ–±–∞–≤–ª–µ–Ω—ã:
```sql
ALTER PUBLICATION supabase_realtime ADD TABLE auctions;
ALTER PUBLICATION supabase_realtime ADD TABLE auction_bids;
ALTER PUBLICATION supabase_realtime ADD TABLE auction_participants;

CREATE POLICY "Allow public read access to auctions" ON auctions FOR SELECT USING (true);
CREATE POLICY "Allow public read access to auction_bids" ON auction_bids FOR SELECT USING (true);
CREATE POLICY "Allow public read access to auction_participants" ON auction_participants FOR SELECT USING (true);
```

### 6. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è finish_auction ‚úÖ

–û–±–Ω–æ–≤–ª—ë–Ω `ON CONFLICT` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º constraint `(user_id, material_id, quality)`:
```sql
INSERT INTO user_warehouse_inventory (
  user_id, material_id, quantity, quality, durability, comfort, style
)
VALUES (...)
ON CONFLICT (user_id, material_id, quality)  -- –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
DO UPDATE SET quantity = user_warehouse_inventory.quantity + v_quantity
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

### –¢–µ—Å—Ç 1: Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–≤–æ–∫
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞—É–∫—Ü–∏–æ–Ω –≤ **–¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö/–æ–∫–Ω–∞—Ö**
2. –í –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ —Å–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É
3. ‚úÖ –í–æ –≤—Ç–æ—Ä–æ–π –≤–∫–ª–∞–¥–∫–µ —Å—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** –ø–æ—è–≤–∏—Ç—å—Å—è
4. ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –æ–±–Ω–æ–≤–∏—Ç—Å—è –≤ –æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö

### –¢–µ—Å—Ç 2: –¢–∞–π–º–µ—Ä
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞—É–∫—Ü–∏–æ–Ω
2. ‚úÖ –¢–∞–π–º–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç—Å—á–∏—Ç—ã–≤–∞—Ç—å –æ—Ç 60 –¥–æ 0
3. ‚úÖ –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 0 –∞—É–∫—Ü–∏–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
4. ‚úÖ –ú–∞—Ç–µ—Ä–∏–∞–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—é

### –¢–µ—Å—Ç 3: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Realtime
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞—É–∫—Ü–∏–æ–Ω (—Å—Ç–∞—Ç—É—Å "waiting")
2. –í –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Å–µ–π—á–∞—Å"
3. ‚úÖ –í –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ —Å—Ç–∞—Ç—É—Å —Å–º–µ–Ω–∏—Ç—Å—è –Ω–∞ "active"
4. ‚úÖ –¢–∞–π–º–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –¢–µ—Å—Ç 4: –£—á–∞—Å—Ç–Ω–∏–∫–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞—É–∫—Ü–∏–æ–Ω –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –ø–æ–¥ —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
2. ‚úÖ –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
3. ‚úÖ –°—á—ë—Ç—á–∏–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

## –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∞—É–∫—Ü–∏–æ–Ω—É: SUBSCRIBED
üîÑ Realtime UPDATE auction: {old_status: 'waiting', new_status: 'active', ...}
üöÄ –ê—É–∫—Ü–∏–æ–Ω –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ Realtime!
üí∞ Realtime NEW BID: {amount: 150, player_name: 'player@example.com', ...}
üë§ Realtime NEW PARTICIPANT: {player_name: 'newplayer@example.com', ...}
‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ, –∑–∞–≤–µ—Ä—à–∞–µ–º –∞—É–∫—Ü–∏–æ–Ω
üèÅ –ê—É–∫—Ü–∏–æ–Ω –∑–∞–≤–µ—Ä—à—ë–Ω —á–µ—Ä–µ–∑ Realtime!
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### Realtime –∫–∞–Ω–∞–ª—ã:
- **–ö–∞–Ω–∞–ª**: `auction:${auctionId}`
- **–°–æ–±—ã—Ç–∏—è**: `postgres_changes`
- **–¢–∞–±–ª–∏—Ü—ã**: `auctions`, `auction_bids`, `auction_participants`
- **–§–∏–ª—å—Ç—Ä—ã**: `auction_id=eq.${auctionId}`

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- –ó–∞–¥–µ—Ä–∂–∫–∞ Realtime: ~100-500–º—Å
- –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Realtime: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- RLS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∞—É–∫—Ü–∏–æ–Ω–∞
- –ü–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—é—Ç —á—Ç–µ–Ω–∏–µ –≤—Å–µ–º (public)
- –ó–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ RPC —Ñ—É–Ω–∫—Ü–∏–∏ (SECURITY DEFINER)

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

1. –ï—Å–ª–∏ Realtime –æ—Ç–∫–ª—é—á–∏—Ç—Å—è (–∏–Ω—Ç–µ—Ä–Ω–µ—Ç –ø—Ä–æ–ø–∞–ª), –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. –ü—Ä–∏ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (>50) –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∞
3. –¢–∞–π–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±–∞–∑—É –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥

## –°–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:

- [ ] –†–µ–∫–æ–Ω–Ω–µ–∫—Ç –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ Realtime —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –ü–æ–∫–∞–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ"
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–æ–∫ –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- [ ] Heartbeat –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
